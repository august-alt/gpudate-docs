<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-gpoa/util/preg" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">preg | GPUpdate Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://gpupdate-docs.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://gpupdate-docs.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://gpupdate-docs.github.io/docs/gpoa/util/preg"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="preg | GPUpdate Docs"><meta data-rh="true" name="description" content="FunctionDef loadpreg(filepath)"><meta data-rh="true" property="og:description" content="FunctionDef loadpreg(filepath)"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://gpupdate-docs.github.io/docs/gpoa/util/preg"><link data-rh="true" rel="alternate" href="https://gpupdate-docs.github.io/docs/gpoa/util/preg" hreflang="en"><link data-rh="true" rel="alternate" href="https://gpupdate-docs.github.io/docs/gpoa/util/preg" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.d27c289a.css">
<script src="/assets/js/runtime~main.e7149247.js" defer="defer"></script>
<script src="/assets/js/main.19b81b89.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">GPUpdate Docs</b></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/gpoa/backend/applier_backend">gpoa</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/gpoa/backend/applier_backend">backend</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/gpoa/frontend/applier_frontend">frontend</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/gpoa/gpt/">gpt</a><button aria-label="Expand sidebar category &#x27;gpt&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/gpoa/plugin/">plugin</a><button aria-label="Expand sidebar category &#x27;plugin&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/gpoa/storage/cache">storage</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/gpoa/test/frontend/appliers/test_controls">test</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/gpoa/util/">util</a><button aria-label="Collapse sidebar category &#x27;util&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/gpoa/util/arguments">arguments</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/gpoa/util/config">config</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/gpoa/util/dbus">dbus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/gpoa/util/exceptions">exceptions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/gpoa/util/gpoa_ini_parsing">gpoa_ini_parsing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/gpoa/util/kerberos">kerberos</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/gpoa/util/logging">logging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/gpoa/util/paths">paths</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/gpoa/util/preg">preg</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/gpoa/util/roles">roles</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/gpoa/util/rpm">rpm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/gpoa/util/samba">samba</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/gpoa/util/sid">sid</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/gpoa/util/signals">signals</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/gpoa/util/system">system</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/gpoa/util/users">users</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/gpoa/util/windows">windows</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/gpoa/util/xdg">xdg</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/gpoa/util/xml">xml</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/tools/parsing_chrom_admx_intvalues">tools</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">gpoa</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/gpoa/util/"><span itemprop="name">util</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">preg</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>preg</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="functiondef-load_pregfile_path">FunctionDef load_preg(file_path)<a href="#functiondef-load_pregfile_path" class="hash-link" aria-label="Direct link to FunctionDef load_preg(file_path)" title="Direct link to FunctionDef load_preg(file_path)">​</a></h2>
<p><strong>load_preg</strong>: The function of load_preg is to check the file extension of the provided file path and load the corresponding object. It returns a preg object if the file extension is .xml and a pol object if the file extension is not .xml.</p>
<p><strong>parameters</strong>:</p>
<p>· file_path (string): The path to the file that needs to be loaded.</p>
<p><strong>Code Description</strong>:</p>
<p>The function begins by checking the file extension of the provided file_path. If the file extension is .xml, it calls the load_xml_preg function and returns the preg object. If the file extension is not .xml, it calls the load_pol_preg function and returns the pol object.</p>
<p>The load_xml_preg function parses an XML/PReg file and returns its preg object. It logs the xml_path parameter using the log() function and creates a GPPolParser object. The function then uses the ElementTree library to parse the XML/PReg file and loads it into the GPPolParser object using the load_xml() function. Finally, it returns the preg object of the XML/PReg file using the pol_file attribute of the GPPolParser object.</p>
<p>The load_pol_preg function parses a PReg file and returns its pol object. It logs the polfile using the log() function from the logging.py module and creates an instance of the GPPolParser class. The function then reads the contents of the polfile using a try-except block and calls the parse() method of the GPPolParser object with data as its argument to parse the PReg file. After parsing the PReg file, the function calls preg2entries() function with gpparser.pol_file as its argument to convert the parsed PReg file into a list of entry objects. The resulting list of entry objects is returned by the function.</p>
<p>The load_preg function is called by the lp2gpt function in the gpoa/gpt/gpt.py module, the read_polfile function in the gpoa/gpt/polfile.py module, the preg_keymap function in the gpoa/util/preg.py module, and the merge_polfile function in the gpoa/util/preg.py module.</p>
<p><strong>Note</strong>:</p>
<ul>
<li>The function assumes that the provided file_path is a valid path to a file.</li>
<li>The function returns a preg or pol object, which can be used for further processing.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="functiondef-load_xml_pregxml_path">FunctionDef load_xml_preg(xml_path)<a href="#functiondef-load_xml_pregxml_path" class="hash-link" aria-label="Direct link to FunctionDef load_xml_preg(xml_path)" title="Direct link to FunctionDef load_xml_preg(xml_path)">​</a></h2>
<p><strong>load_xml_preg</strong>: The function of load_xml_preg is to parse an XML/PReg file and return its preg object.</p>
<p><strong>parameters</strong>:</p>
<p>· xml_path (string): The path to the XML/PReg file.</p>
<p><strong>Code Description</strong>:</p>
<p>The function begins by logging the xml_path parameter using the log() function. It then creates a GPPolParser object, which is used to parse the XML/PReg file. The ElementTree library is used to parse the XML/PReg file, and the parsed XML/PReg file is loaded into the GPPolParser object using the load_xml() function.</p>
<p>The GPPolParser object is then used to get the preg object of the XML/PReg file using the pol_file attribute. The preg object is returned by the function.</p>
<p>This function is called by the load_preg function in the same module (gpoa/util/preg.py). The load_preg function checks the file extension of the provided file path. If the file extension is .xml, it calls the load_xml_preg function and returns the preg object. If the file extension is not .xml, it calls the load_pol_preg function and returns the pol object.</p>
<p><strong>Note</strong>:</p>
<ul>
<li>The function assumes that the provided xml_path is a valid path to an XML/PReg file.</li>
<li>The function returns a preg object, which can be used for further processing.</li>
</ul>
<p><strong>Code Description</strong>:</p>
<p>The function begins by logging the polfile using the log() function from the logging.py module. It then creates an instance of the GPPolParser class. A try-except block is used to read the contents of the polfile. If the file is opened successfully, the contents are read into the data variable as bytes, and the size of the file is logged using the log() function. The GPPolParser object&#x27;s parse() method is then called with data as its argument to parse the PReg file.</p>
<p>After parsing the PReg file, the function calls preg2entries() function with gpparser.pol_file as its argument to convert the parsed PReg file into a list of entry objects. The resulting list of entry objects is returned by the function.</p>
<p>The function load_pol_preg is called by the load_preg function in the same module. The load_preg function checks the file extension of the input file_path. If the file extension is .xml, it calls the load_xml_preg function, otherwise, it calls the load_pol_preg function. This allows the system to handle both XML and PReg files seamlessly.</p>
<p><strong>Note</strong>:</p>
<ul>
<li>The function assumes that the input polfile is a valid PReg file.</li>
<li>The function logs the polfile and its size during the execution.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="functiondef-preg_keymappreg">FunctionDef preg_keymap(preg)<a href="#functiondef-preg_keymappreg" class="hash-link" aria-label="Direct link to FunctionDef preg_keymap(preg)" title="Direct link to FunctionDef preg_keymap(preg)">​</a></h2>
<p><strong>preg_keymap</strong>: The function of preg_keymap is to create a dictionary of key-value pairs, where the keys are constructed from the keyname and valuename of each entry in the provided preg object, and the values are the corresponding entry objects.</p>
<p><strong>parameters</strong>:</p>
<p>· preg (object): The preg object to be processed. This object is obtained by calling the load_preg function, which checks the file extension of the provided file path and returns a preg object if the file extension is .xml or a pol object if the file extension is not .xml.</p>
<p><strong>Code Description</strong>:</p>
<p>The function begins by calling the load_preg function to load the preg object from the provided file path. It then initializes an empty dictionary called keymap.</p>
<p>The function then iterates over the entries in the pregfile (which is the preg object). For each entry, it constructs a key by concatenating the entry&#x27;s keyname and valuename with a backslash in between. This key represents the hierarchical relationship between the keyname and valuename. The function then adds a new key-value pair to the keymap dictionary, where the key is the constructed key and the value is the entry object.</p>
<p>Finally, the function returns the keymap dictionary, which can be used for further processing.</p>
<p><strong>Note</strong>:</p>
<ul>
<li>The function assumes that the provided file_path is a valid path to a file and that the load_preg function has been called before calling this function.</li>
<li>The function returns a dictionary of key-value pairs, where the keys are strings representing the hierarchical relationship between the keyname and valuename, and the values are the corresponding entry objects.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="functiondef-merge_polfilepreg-sid-reg_name-reg_path-policy_name">FunctionDef merge_polfile(preg, sid, reg_name, reg_path, policy_name)<a href="#functiondef-merge_polfilepreg-sid-reg_name-reg_path-policy_name" class="hash-link" aria-label="Direct link to FunctionDef merge_polfile(preg, sid, reg_name, reg_path, policy_name)" title="Direct link to FunctionDef merge_polfile(preg, sid, reg_name, reg_path, policy_name)">​</a></h2>
<p><strong>merge_polfile</strong>: The function of merge_polfile is to merge a specified policy file (in XML/PReg format) into the registry storage object, either HKEY_LOCAL_MACHINE (HKLM) or HKEY_CURRENT_USER (HKCU), based on the provided SID (Security Identifier).</p>
<p><strong>parameters</strong>:
· <code>preg</code>: A string representing the path to the policy file (in XML/PReg format) to be merged.
· <code>sid</code> (optional): A string representing the SID of the user associated with the HKCU registry hive. If not provided, the function assumes that the policy file should be merged into the HKLM registry hive.
· <code>reg_name</code> (optional): A string specifying the name of the registry storage object. It can be &#x27;registry&#x27; or &#x27;registry_hive&#x27;. If not provided, the function assumes that the registry storage object is &#x27;registry&#x27;.
· <code>policy_name</code> (optional): A string specifying the name of the policy applied to the registry entries. If not provided, the function uses the default value &#x27;Unknown&#x27;.</p>
<p><strong>Code Description</strong>:
The merge_polfile function begins by loading the policy file using the load_preg function, which returns a preg object if the file extension is .xml and a pol object if the file extension is not .xml. The function then logs the pregfile using the log() function.</p>
<p>Next, the function creates a registry storage object using the registry_factory function, which takes the registry_name and reg_path parameters. If the sid parameter is not provided, the function assumes that the policy file should be merged into the HKLM registry hive. Otherwise, it assumes that the policy file should be merged into the HKCU registry hive and sets the sid parameter for the registry storage object.</p>
<p>The function then iterates over the entries in the pregfile and checks if the sid parameter is provided. If the sid parameter is not provided, the function calls the add_hklm_entry function to add the entry to the HKLM registry hive. Otherwise, it calls the add_hkcu_entry function to add the entry to the HKCU registry hive.</p>
<p>Finally, the function commits the changes to the registry storage object using the commit() method.</p>
<p><strong>Relationship with its callers in the project</strong>:
The merge_polfile function is primarily called by the merge_machine and merge_user functions in the gpoa/gpt/gpt.py module. The merge_machine function reads a machine policy file and calls merge_polfile for each entry in the file to write the entries to the HKLM registry hive. The merge_user function reads a user policy file and calls merge_polfile for each entry in the file to write the entries to the HKCU registry hive.</p>
<p>The merge_polfile function is also called by the test_add_hklm_entry and test_add_hkcu_entry functions in the gpoa/test/storage/test_preg_special_values.py module to test the functionality of the add_hklm_entry and add_hkcu_entry functions, respectively.</p>
<p><strong>Note</strong>:
When using the merge_polfile function, ensure that the preg parameter is correctly set according to the target policy file in the XML/PReg format. Additionally, note that the function will add the entries to the HKLM registry hive if the sid parameter is not provided and to the HKCU registry hive if the sid parameter is provided. Therefore, use this function with caution, especially when adding keys associated with critical system functionalities.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="classdef-entry">ClassDef entry<a href="#classdef-entry" class="hash-link" aria-label="Direct link to ClassDef entry" title="Direct link to ClassDef entry">​</a></h2>
<p><strong>entry</strong>: The function of the entry class is to initialize and create an object that contains information about a key-value pair, along with its type and data.</p>
<p><strong>attributes</strong>:
· e_keyname: The name of the key.
· e_valuename: The name of the value.
· e_type: The type of the key-value pair.
· e_data: The data associated with the key-value pair.</p>
<p><strong>Code Description</strong>:
The <code>__init__</code> method initializes the object with the given key-name, value-name, type, and data. It also creates a dictionary <code>logdata</code> that contains the same information as the initialized object. The <code>logdata</code> dictionary is then used to log the information for debugging purposes.</p>
<p>The class <code>entry</code> is used in the <code>preg2entries</code> function of the <code>preg.py</code> module to convert a list of <code>elem</code> objects into a list of <code>entry</code> objects. The <code>elem</code> objects are iterated over and for each <code>elem</code>, an <code>entry</code> object is created with the same key-name, value-name, type, and data. The created <code>entry</code> object is then added to the <code>entries</code> list.</p>
<p><strong>Note</strong>:
It is important to note that the <code>logdata</code> dictionary is used for debugging purposes only and should not be used for any other purpose. Also, the <code>entry</code> class is intended to be used as a simple data container and should not contain any complex logic or functionality.</p>
<p>Additionally, the <code>entry</code> class is not intended to be used outside of the <code>preg2entries</code> function and should not be used as a standalone class. It is tightly coupled with the <code>preg.py</code> module and should be used in conjunction with the other classes and functions of that module.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="functiondef-initself-e_keyname-e_valuename-e_type-e_data">FunctionDef <strong>init</strong>(self, e_keyname, e_valuename, e_type, e_data)<a href="#functiondef-initself-e_keyname-e_valuename-e_type-e_data" class="hash-link" aria-label="Direct link to functiondef-initself-e_keyname-e_valuename-e_type-e_data" title="Direct link to functiondef-initself-e_keyname-e_valuename-e_type-e_data">​</a></h3>
<p><strong><strong>init</strong></strong>: The function of <strong><strong>init</strong></strong> is to initialize an object of the entry class with the required parameters.</p>
<p><strong>parameters</strong>: The parameters of this Function.
· e_keyname: The name of the key for the entry object.
· e_valuename: The name of the value for the entry object.
· e_type: The type of the entry object.
· e_data: The data of the entry object.</p>
<p><strong>Code Description</strong>:</p>
<p>The <strong><strong>init</strong></strong> function initializes an object of the entry class with the given parameters. It sets the keyname, valuename, type, and data attributes of the object to the corresponding input parameters.</p>
<p>Additionally, it creates a dictionary called logdata, which contains the same key-value pairs as the object attributes. This logdata dictionary is then passed as an argument to the log function, along with a message code of &#x27;D22&#x27;.</p>
<p>The log function checks the first character of the message code to determine the type of log message to create (informational, warning, error, fatal, or debug). It then creates a log message using the provided message code and data dictionary, and writes it to the appropriate log.</p>
<p>The purpose of logging the entry object&#x27;s attributes is to keep a record of the object&#x27;s properties at the time of its creation. This can be useful for debugging and troubleshooting purposes, as it allows developers to see exactly what values were used to create a particular object.</p>
<p><strong>Note</strong>:</p>
<p>It is important to ensure that the input parameters to the <strong><strong>init</strong></strong> function are valid and correctly formatted, as they will be used to create the object&#x27;s attributes and log message. If any errors are encountered during object creation, they should be caught and handled appropriately to prevent crashes or unexpected behavior.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="classdef-pentries">ClassDef pentries<a href="#classdef-pentries" class="hash-link" aria-label="Direct link to ClassDef pentries" title="Direct link to ClassDef pentries">​</a></h2>
<p><strong>pentries</strong>: The function of pentries is to create and manage a list of entry objects.</p>
<p><strong>attributes</strong>:
· entries: This is a list that will contain entry objects.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="functiondef-initself">FunctionDef <strong>init</strong>(self)<a href="#functiondef-initself" class="hash-link" aria-label="Direct link to functiondef-initself" title="Direct link to functiondef-initself">​</a></h3>
<p><strong><strong>init</strong></strong>: The function of <strong>init</strong> is to initialize the pentries object and create an empty list for storing entries.</p>
<p><strong>parameters</strong>: This function does not take any parameters.</p>
<p><strong>Code Description</strong>:
The <code>__init__</code> function is a special method in Python classes, called when an object is initialized. In this case, it is used to set up the initial state of the pentries object.</p>
<p>The first statement in the function is <code>self.entries = list()</code>, which creates an empty list and assigns it to the <code>entries</code> attribute of the object. This list will be used to store entry objects as they are added to the pentries object.</p>
<p><strong>Note</strong>:</p>
<ul>
<li>The <code>__init__</code> function is automatically called when a new object is created from the pentries class. Therefore, there is no need to explicitly call this function in your code.</li>
<li>The <code>entries</code> attribute is a list that will contain entry objects. Make sure to only append instances of the appropriate entry class to this list.</li>
<li>If you need to add additional functionality to the pentries object, consider adding it to the <code>__init__</code> function or creating additional methods within the class.</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="functiondef-preg2entriespreg_obj">FunctionDef preg2entries(preg_obj)<a href="#functiondef-preg2entriespreg_obj" class="hash-link" aria-label="Direct link to FunctionDef preg2entries(preg_obj)" title="Direct link to FunctionDef preg2entries(preg_obj)">​</a></h2>
<p><strong>preg2entries</strong>: The function of preg2entries is to convert a <code>preg_obj</code> object into a list of <code>entry</code> objects. This function takes a <code>preg_obj</code> object as input and returns a <code>pentries</code> object containing a list of <code>entry</code> objects.</p>
<p><strong>parameters</strong>:
· <code>preg_obj</code>: An object containing a list of <code>elem</code> objects.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/gpoa/util/paths"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">paths</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/gpoa/util/roles"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">roles</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#functiondef-load_pregfile_path" class="table-of-contents__link toc-highlight">FunctionDef load_preg(file_path)</a></li><li><a href="#functiondef-load_xml_pregxml_path" class="table-of-contents__link toc-highlight">FunctionDef load_xml_preg(xml_path)</a></li><li><a href="#functiondef-preg_keymappreg" class="table-of-contents__link toc-highlight">FunctionDef preg_keymap(preg)</a></li><li><a href="#functiondef-merge_polfilepreg-sid-reg_name-reg_path-policy_name" class="table-of-contents__link toc-highlight">FunctionDef merge_polfile(preg, sid, reg_name, reg_path, policy_name)</a></li><li><a href="#classdef-entry" class="table-of-contents__link toc-highlight">ClassDef entry</a><ul><li><a href="#functiondef-initself-e_keyname-e_valuename-e_type-e_data" class="table-of-contents__link toc-highlight">FunctionDef <strong>init</strong>(self, e_keyname, e_valuename, e_type, e_data)</a></li></ul></li><li><a href="#classdef-pentries" class="table-of-contents__link toc-highlight">ClassDef pentries</a><ul><li><a href="#functiondef-initself" class="table-of-contents__link toc-highlight">FunctionDef <strong>init</strong>(self)</a></li></ul></li><li><a href="#functiondef-preg2entriespreg_obj" class="table-of-contents__link toc-highlight">FunctionDef preg2entries(preg_obj)</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/gpoa/backend/samba_backend">Samba Backend</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 BaseALT LTD, Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>