<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-gpoa/storage/sqlite_cache" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">sqlite_cache | GPUpdate Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://gpupdate-docs.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://gpupdate-docs.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://gpupdate-docs.github.io/docs/gpoa/storage/sqlite_cache"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="sqlite_cache | GPUpdate Docs"><meta data-rh="true" name="description" content="FunctionDef mappingfactory(mappersuffix)"><meta data-rh="true" property="og:description" content="FunctionDef mappingfactory(mappersuffix)"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://gpupdate-docs.github.io/docs/gpoa/storage/sqlite_cache"><link data-rh="true" rel="alternate" href="https://gpupdate-docs.github.io/docs/gpoa/storage/sqlite_cache" hreflang="en"><link data-rh="true" rel="alternate" href="https://gpupdate-docs.github.io/docs/gpoa/storage/sqlite_cache" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.d27c289a.css">
<script src="/assets/js/runtime~main.e7149247.js" defer="defer"></script>
<script src="/assets/js/main.19b81b89.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">GPUpdate Docs</b></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/gpoa/backend/applier_backend">gpoa</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/gpoa/backend/applier_backend">backend</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/gpoa/frontend/applier_frontend">frontend</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/gpoa/gpt/">gpt</a><button aria-label="Expand sidebar category &#x27;gpt&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/gpoa/plugin/">plugin</a><button aria-label="Expand sidebar category &#x27;plugin&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/gpoa/storage/cache">storage</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/gpoa/storage/cache">cache</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/gpoa/storage/fs_file_cache">fs_file_cache</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/gpoa/storage/record_types">record_types</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/gpoa/storage/registry">registry</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/gpoa/storage/sqlite_cache">sqlite_cache</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/gpoa/storage/sqlite_registry">sqlite_registry</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/gpoa/storage/sqlite_registry_compat">sqlite_registry_compat</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/gpoa/test/frontend/appliers/test_controls">test</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/gpoa/util/">util</a><button aria-label="Expand sidebar category &#x27;util&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/tools/parsing_chrom_admx_intvalues">tools</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">gpoa</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">storage</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">sqlite_cache</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>sqlite_cache</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="functiondef-mapping_factorymapper_suffix">FunctionDef mapping_factory(mapper_suffix)<a href="#functiondef-mapping_factorymapper_suffix" class="hash-link" aria-label="Direct link to FunctionDef mapping_factory(mapper_suffix)" title="Direct link to FunctionDef mapping_factory(mapper_suffix)">​</a></h2>
<p><strong>mapping_factory</strong></p>
<p>The <code>mapping_factory</code> function&#x27;s purpose is to create a class dynamically based on a given suffix string. This dynamically created class is used for mapping string IDs to their respective values.</p>
<p><strong>Parameters</strong></p>
<p>· <code>mapper_suffix</code>: A string value that is used as a suffix for the dynamically created class name.</p>
<p><strong>Code Description</strong></p>
<p>The <code>mapping_factory</code> function uses the <code>exec</code> function to execute a string containing Python code that creates a new class named <code>mapped_id_{}</code> (where <code>{}</code> is replaced by the <code>mapper_suffix</code> parameter value). This class has an <code>__init__</code> method that takes two arguments: <code>str_id</code> and <code>value</code>. The <code>str_id</code> argument is a string representation of the object&#x27;s ID, and <code>value</code> is the actual value associated with the ID.</p>
<p>The function then returns the dynamically created class using the <code>eval</code> function, which evaluates the string <code>&#x27;mapped_id_{}&#x27;</code> (where <code>{}</code> is replaced by the <code>mapper_suffix</code> parameter value) and returns the resulting object.</p>
<p>In the context of the <code>sqlite_cache</code> class, the <code>mapping_factory</code> function is used to create a custom mapper object that is used to map string IDs to their respective values in a SQLite database.</p>
<p><strong>Note</strong></p>
<p>The <code>mapping_factory</code> function uses dynamic code execution, which can be risky if the input is not trusted. In this case, the <code>mapper_suffix</code> parameter is constructed from the <code>cache_name</code> attribute of the <code>sqlite_cache</code> class, which is assumed to be trusted.</p>
<p><strong>Output Example</strong></p>
<p>Assuming the <code>cache_name</code> attribute of the <code>sqlite_cache</code> class is set to <code>&quot;test&quot;</code>, the <code>mapping_factory</code> function would return the following class:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">mapped_id_test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">object</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> str_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">str_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> str_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This class can then be used to map string IDs to their respective values in a SQLite database.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="classdef-sqlite_cache">ClassDef sqlite_cache<a href="#classdef-sqlite_cache" class="hash-link" aria-label="Direct link to ClassDef sqlite_cache" title="Direct link to ClassDef sqlite_cache">​</a></h2>
<p><strong>sqlite_cache</strong>: The <code>sqlite_cache</code> class is a concrete implementation of the <code>cache</code> abstract base class that uses an SQLite database to store and retrieve data using string identifiers. It inherits from the <code>cache</code> class and provides a concrete implementation of the <code>store</code>, <code>get</code>, and <code>get_default</code> methods.</p>
<p><strong>Attributes</strong>:</p>
<ul>
<li><code>cache_name</code>: A string identifier that specifies the name of the SQLite database file.</li>
</ul>
<p><strong>Code Description</strong>:</p>
<p>The <code>sqlite_cache</code> class initializes an SQLite database and creates a table for storing data. It also creates a session object for interacting with the database. The <code>store</code> method takes a string identifier and a value as arguments and stores the value in the database using the identifier. The <code>get</code> method takes a string identifier as an argument and retrieves the corresponding value from the database. If the value is not found, it returns <code>None</code>. The <code>get_default</code> method takes a string identifier and a default value as arguments. It retrieves the value from the database using the identifier. If the value is not found, it stores the default value in the database and returns it.</p>
<p>The <code>sqlite_cache</code> class uses the <code>cache</code> class as a parent class to provide a consistent interface for storing and retrieving data. By using the <code>cache</code> class as a parent class, the <code>sqlite_cache</code> class can be used interchangeably with other concrete cache implementations that inherit from the <code>cache</code> class. This allows developers to write code that works with any concrete cache implementation, making it easier to switch between different cache implementations as needed.</p>
<p>The <code>sqlite_cache</code> class is used as a concrete implementation of the <code>cache</code> interface in the <code>gpoa/storage/sqlite_cache.py</code> module. It is instantiated by the <code>cache_factory</code> function in the <code>gpoa/storage/__init__.py</code> module, which is used to create cache objects based on a specified cache name. The <code>cache_factory</code> function returns a <code>sqlite_cache</code> object when the specified cache name corresponds to an SQLite database.</p>
<p><strong>Note</strong>:</p>
<ul>
<li>The <code>sqlite_cache</code> class is a concrete implementation of the <code>cache</code> interface and cannot be used as a parent class for other cache implementations.</li>
<li>The <code>sqlite_cache</code> class uses an SQLite database to store and retrieve data. It is not suitable for use in distributed systems or systems with high concurrency requirements.</li>
<li>The <code>sqlite_cache</code> class is intended to be used as a cache implementation for storing and retrieving data in a single-process, single-threaded environment.</li>
</ul>
<p><strong>Output Example</strong>:</p>
<p>Here is an example of how the <code>sqlite_cache</code> class can be used:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> gpoa</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">storage</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sqlite_cache </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> sqlite_cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cache </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sqlite_cache</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;my_cache&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">store</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;key1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;value1&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">store</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;key2&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;value2&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">value1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;key1&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># returns &#x27;value1&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">value2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;key2&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># returns &#x27;value2&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">value3 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;key3&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># returns None</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">default_value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_default</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;key3&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;default_value&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># returns &#x27;default_value&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this example, a <code>sqlite_cache</code> object is created with the name <code>&#x27;my_cache&#x27;</code>. The <code>store</code> method is used to store two values in the cache, and the <code>get</code> method is used to retrieve the values from the cache. If a value is not found in the cache, the <code>get_default</code> method is used to retrieve a default value.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="functiondef-initself-cache_name">FunctionDef <strong>init</strong>(self, cache_name)<a href="#functiondef-initself-cache_name" class="hash-link" aria-label="Direct link to functiondef-initself-cache_name" title="Direct link to functiondef-initself-cache_name">​</a></h3>
<p><strong><strong>init</strong></strong>: The function of <strong><strong>init</strong></strong> is to initialize the sqlite_cache object with a given cache name.</p>
<p><strong>parameters</strong>:
· <strong>cache_name</strong>: A string value representing the name of the cache.</p>
<p><strong>Code Description</strong>:
The <strong><strong>init</strong></strong> function initializes the sqlite_cache object by first setting the cache name and then creating a mapper object using the <code>mapping_factory</code> function. The <code>mapping_factory</code> function creates a class dynamically based on the cache name and returns an instance of that class. This dynamically created class is used for mapping string IDs to their respective values.</p>
<p>Next, the function creates a SQLite database connection string using the <code>cache_dir</code> function to get the cache directory and the cache name. The <code>os.path.join</code> function is used to join the cache directory and the cache name with the <code>sqlite:///</code> prefix to create the connection string.</p>
<p>The function then creates a SQLAlchemy connectable object using the connection string and initializes the <code>db_cnt</code> attribute. The <code>create_engine</code> function from SQLAlchemy is used to create the connectable object.</p>
<p>The function then initializes the <code>__compat</code> attribute by creating an instance of the <code>sqlite_registry_compat</code> class with the <code>db_cnt</code> attribute. The <code>sqlite_registry_compat</code> class provides a compatibility layer for working with SQLite metadata in a more straightforward manner.</p>
<p>The function then initializes the <code>__metadata</code> attribute by calling the <code>metadata</code> method of the <code>__compat</code> attribute. The <code>metadata</code> method returns the metadata object associated with the <code>sqlite_registry_compat</code> object.</p>
<p>The function then creates a cache table using the <code>cache_name</code> attribute, the <code>mapper_obj</code> attribute, and the <code>__metadata</code> attribute. The <code>Table</code> class from SQLAlchemy is used to create the cache table. The cache table has three columns: <code>id</code>, <code>str_id</code>, and <code>value</code>. The <code>id</code> column is an Integer column and is the primary key of the table. The <code>str_id</code> column is a String column and is unique for each row. The <code>value</code> column is a String column and stores the actual value associated with the ID.</p>
<p>Finally, the function creates a session object using the <code>Session</code> class from SQLAlchemy and initializes the <code>db_session</code> attribute. The <code>sessionmaker</code> function from SQLAlchemy is used to create the session object.</p>
<p>In summary, the <strong><strong>init</strong></strong> function initializes the sqlite_cache object with a given cache name and creates a SQLite database connection, a mapper object, a SQLAlchemy connectable object, a <code>sqlite_registry_compat</code> object, a metadata object, a cache table, and a session object.</p>
<p><strong>Note</strong>:</p>
<ul>
<li>The <code>mapping_factory</code> function creates a class dynamically based on the cache name, which can be risky if the input is not trusted. In this case, the <code>cache_name</code> attribute is assumed to be trusted.</li>
<li>The <code>sqlite_registry_compat</code> class provides a compatibility layer for working with SQLite metadata in a more straightforward manner. If you are using a version of SQLAlchemy that is compatible with the registry object, you can set <code>__compat__</code> to True to use the more straightforward interface provided by <code>sqlite_registry_compat</code>.</li>
<li>The <code>db_session</code> attribute is an instance of the SQLAlchemy <code>Session</code> class, which provides a handle to the database connection and allows you to perform database operations. It is important to always close the session object after performing database operations to release the database connection.</li>
</ul>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="functiondef-storeself-str_id-value">FunctionDef store(self, str_id, value)<a href="#functiondef-storeself-str_id-value" class="hash-link" aria-label="Direct link to FunctionDef store(self, str_id, value)" title="Direct link to FunctionDef store(self, str_id, value)">​</a></h3>
<p><strong>store</strong>: The <code>store</code> function upserts a given object into the SQLite database session.</p>
<p><strong>parameters</strong>
· <code>self</code>: The instance of the <code>sqlite_cache</code> class.
· <code>str_id</code>: A string representing the unique identifier of the object to be stored.
· <code>value</code>: The value of the object to be stored.</p>
<p><strong>Code Description</strong>
The <code>store</code> function begins by creating an object using the <code>str_id</code> and <code>value</code> parameters using the <code>self.mapper_obj</code> method. This object is then passed as a parameter to the <code>_upsert</code> method, which handles the upsert operation in the SQLite database session.</p>
<p>The <code>_upsert</code> method attempts to add the given object to the database session using the <code>self.db_session.add(obj)</code> method. If adding the object is successful, the database session is committed using <code>self.db_session.commit()</code>.</p>
<p>If adding the object raises an exception, the function proceeds to handle the exception by rolling back the current database session using <code>self.db_session.rollback()</code>. A log data dictionary is then created with a message containing the exception information. The <code>log</code> function is called with the message code &#x27;D44&#x27; and the log data as parameters.</p>
<p>After logging the exception, the function updates the existing record in the database with the same <code>str_id</code> as the given object using the following query:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">db_session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mapper_obj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mapper_obj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">str_id </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> obj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">str_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;value&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> obj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Finally, the updated database session is committed using <code>self.db_session.commit()</code>.</p>
<p>The <code>store</code> function is called by the <code>get_default</code> method of the <code>sqlite_cache</code> class. The <code>get_default</code> method takes in an <code>obj_id</code> and a <code>default_value</code> as parameters, and it calls <code>store</code> to store the <code>default_value</code> with the <code>obj_id</code> if the <code>obj_id</code> does not exist in the database.</p>
<p><strong>Note</strong></p>
<ul>
<li>The <code>store</code> function is designed to handle exceptions that may occur when adding an object to the database session. It is important to note that the function will only attempt to update the existing record in the database if an exception is raised.</li>
<li>The <code>log</code> function is used to log any exceptions that may occur during the execution of the <code>_upsert</code> function. It is important to ensure that the <code>log</code> function is properly implemented and configured to handle logging in the application.</li>
<li>The <code>store</code> function is not designed to handle concurrent updates to the same record in the database. It is important to ensure that appropriate database locks or transactions are used to handle concurrent updates.</li>
<li>The <code>store</code> function assumes that the <code>self.db_session</code> and <code>self.mapper_obj</code> attributes have been properly initialized and configured. It is important to ensure that these attributes are properly initialized before calling the <code>store</code> function.</li>
<li>The <code>store</code> function is called by the <code>get_default</code> method to store the default value if the object with the given id does not exist in the database.</li>
</ul>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="functiondef-getself-obj_id">FunctionDef get(self, obj_id)<a href="#functiondef-getself-obj_id" class="hash-link" aria-label="Direct link to FunctionDef get(self, obj_id)" title="Direct link to FunctionDef get(self, obj_id)">​</a></h3>
<p><strong>get</strong>: The function of get is to retrieve an object from the SQLite cache based on the provided object ID.</p>
<p><strong>parameters</strong>:
· obj_id: A string representing the ID of the object to retrieve.</p>
<p><strong>Code Description</strong>:
The <code>get</code> function begins by querying the database session using the <code>db_session.query()</code> method. It filters the results based on the <code>str_id</code> attribute of the mapped object (<code>self.mapper_obj</code>) being equal to the provided <code>obj_id</code>. The <code>first()</code> method is then called to return the first result that matches the query. If a result is found, it is returned; otherwise, the function returns <code>None</code>.</p>
<p>This function is used by the <code>get_default</code> function in the <code>sqlite_cache</code> object to first attempt to retrieve an object from the cache using its ID. If the object is not found in the cache, a default value is stored and returned instead.</p>
<p><strong>Note</strong>:
Be aware that if the object is not found in the cache, the function will return <code>None</code>. It is important to handle this case appropriately in the calling code.</p>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="functiondef-get_defaultself-obj_id-default_value">FunctionDef get_default(self, obj_id, default_value)<a href="#functiondef-get_defaultself-obj_id-default_value" class="hash-link" aria-label="Direct link to FunctionDef get_default(self, obj_id, default_value)" title="Direct link to FunctionDef get_default(self, obj_id, default_value)">​</a></h3>
<p><strong>get_default</strong>: The function of get_default is to retrieve the value of a given object ID from the SQLite cache. If the object ID is not found in the cache, it stores the default value provided and returns it.</p>
<p><strong>parameters</strong>:
· obj_id: A string representing the ID of the object to retrieve.
· default_value: The default value to store and return if the object ID is not found in the cache.</p>
<p><strong>Code Description</strong>:
The <code>get_default</code> function begins by calling the <code>get</code> function of the <code>sqlite_cache</code> object to retrieve the object with the given <code>obj_id</code> from the cache. If the result is <code>None</code>, it means that the object is not found in the cache.</p>
<p>In this case, the function creates a log data dictionary with the <code>object</code> key set to the <code>obj_id</code>. It then calls the <code>log</code> function with the &#x27;D43&#x27; message code and the log data to log the missing object ID.</p>
<p>After logging the missing object ID, the function calls the <code>store</code> function of the <code>sqlite_cache</code> object to store the <code>default_value</code> with the <code>obj_id</code> in the cache.</p>
<p>Finally, the function returns the <code>default_value</code> as a string.</p>
<p>If the result of the <code>get</code> function is not <code>None</code>, the function calls the <code>value</code> attribute of the result to retrieve the value of the object. It then converts the value to a string and returns it.</p>
<p>This function is used by the <code>sqlite_cache</code> object to provide a default value for a given object ID if it is not found in the cache.</p>
<p><strong>Note</strong>:
Be aware that if the object is not found in the cache, the function will return the <code>default_value</code> provided. It is important to handle this case appropriately in the calling code.</p>
<p><strong>Output Example</strong>:
Suppose we have an object with an ID of &quot;abc123&quot; stored in the cache with a value of 123. Calling <code>get_default(&quot;abc123&quot;, 456)</code> would return <code>&quot;123&quot;</code>.</p>
<p>If the object with ID &quot;abc123&quot; is not found in the cache, the function will store the default value of 456 and return it. Therefore, calling <code>get_default(&quot;def456&quot;, 456)</code> would return <code>&quot;456&quot;</code>.</p>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="functiondef-_upsertself-obj">FunctionDef _upsert(self, obj)<a href="#functiondef-_upsertself-obj" class="hash-link" aria-label="Direct link to FunctionDef _upsert(self, obj)" title="Direct link to FunctionDef _upsert(self, obj)">​</a></h3>
<p><strong><code>_upsert</code></strong>: The function of <code>_upsert</code> is to upsert a given object into the SQLite database session.</p>
<p><strong>parameters</strong>
· <code>obj</code>: The object to be upserted into the database.</p>
<p><strong>Code Description</strong>
The <code>_upsert</code> function begins by attempting to add the given object to the database session using the <code>self.db_session.add(obj)</code> method. If adding the object is successful, the database session is committed using <code>self.db_session.commit()</code>.</p>
<p>If adding the object raises an exception, the function proceeds to handle the exception by rolling back the current database session using <code>self.db_session.rollback()</code>. A log data dictionary is then created with a message containing the exception information. The <code>log</code> function is called with the message code &#x27;D44&#x27; and the log data as parameters.</p>
<p>After logging the exception, the function updates the existing record in the database with the same <code>str_id</code> as the given object using the following query:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">db_session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mapper_obj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mapper_obj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">str_id </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> obj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">str_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;value&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> obj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Finally, the updated database session is committed using <code>self.db_session.commit()</code>.</p>
<p>The <code>_upsert</code> function is called by the <code>store</code> method of the <code>sqlite_cache</code> class. The <code>store</code> method takes in a <code>str_id</code> and a <code>value</code> as parameters, creates an object using these parameters, and then calls <code>_upsert</code> to upsert the object into the database.</p>
<p><strong>Note</strong></p>
<ul>
<li>The <code>_upsert</code> function is designed to handle exceptions that may occur when adding an object to the database session. It is important to note that the function will only attempt to update the existing record in the database if an exception is raised.</li>
<li>The <code>log</code> function is used to log any exceptions that may occur during the execution of the <code>_upsert</code> function. It is important to ensure that the <code>log</code> function is properly implemented and configured to handle logging in the application.</li>
<li>The <code>_upsert</code> function is not designed to handle concurrent updates to the same record in the database. It is important to ensure that appropriate database locks or transactions are used to handle concurrent updates.</li>
<li>The <code>_upsert</code> function assumes that the <code>self.db_session</code> and <code>self.mapper_obj</code> attributes have been properly initialized and configured. It is important to ensure that these attributes are properly initialized before calling the <code>_upsert</code> function.</li>
</ul>
<hr></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/gpoa/storage/registry"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">registry</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/gpoa/storage/sqlite_registry"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">sqlite_registry</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#functiondef-mapping_factorymapper_suffix" class="table-of-contents__link toc-highlight">FunctionDef mapping_factory(mapper_suffix)</a></li><li><a href="#classdef-sqlite_cache" class="table-of-contents__link toc-highlight">ClassDef sqlite_cache</a><ul><li><a href="#functiondef-initself-cache_name" class="table-of-contents__link toc-highlight">FunctionDef <strong>init</strong>(self, cache_name)</a></li><li><a href="#functiondef-storeself-str_id-value" class="table-of-contents__link toc-highlight">FunctionDef store(self, str_id, value)</a></li><li><a href="#functiondef-getself-obj_id" class="table-of-contents__link toc-highlight">FunctionDef get(self, obj_id)</a></li><li><a href="#functiondef-get_defaultself-obj_id-default_value" class="table-of-contents__link toc-highlight">FunctionDef get_default(self, obj_id, default_value)</a></li><li><a href="#functiondef-_upsertself-obj" class="table-of-contents__link toc-highlight">FunctionDef _upsert(self, obj)</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/gpoa/backend/samba_backend">Samba Backend</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 BaseALT LTD, Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>