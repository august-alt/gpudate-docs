<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-gpoa/backend/samba_backend" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">samba_backend | GPUpdate Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://gpupdate-docs.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://gpupdate-docs.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://gpupdate-docs.github.io/docs/gpoa/backend/samba_backend"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="samba_backend | GPUpdate Docs"><meta data-rh="true" name="description" content="ClassDef samba_backend"><meta data-rh="true" property="og:description" content="ClassDef samba_backend"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://gpupdate-docs.github.io/docs/gpoa/backend/samba_backend"><link data-rh="true" rel="alternate" href="https://gpupdate-docs.github.io/docs/gpoa/backend/samba_backend" hreflang="en"><link data-rh="true" rel="alternate" href="https://gpupdate-docs.github.io/docs/gpoa/backend/samba_backend" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.d27c289a.css">
<script src="/assets/js/runtime~main.e7149247.js" defer="defer"></script>
<script src="/assets/js/main.19b81b89.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">GPUpdate Docs</b></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/gpoa/backend/applier_backend">gpoa</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/gpoa/backend/applier_backend">backend</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/gpoa/backend/applier_backend">applier_backend</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/gpoa/backend/freeipa_backend">freeipa_backend</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/gpoa/backend/nodomain_backend">nodomain_backend</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/gpoa/backend/samba_backend">samba_backend</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/gpoa/frontend/applier_frontend">frontend</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/gpoa/gpt/">gpt</a><button aria-label="Expand sidebar category &#x27;gpt&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/gpoa/plugin/">plugin</a><button aria-label="Expand sidebar category &#x27;plugin&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/gpoa/storage/cache">storage</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/gpoa/test/frontend/appliers/test_controls">test</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/gpoa/util/">util</a><button aria-label="Expand sidebar category &#x27;util&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/tools/parsing_chrom_admx_intvalues">tools</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">gpoa</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">backend</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">samba_backend</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>samba_backend</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="classdef-samba_backend">ClassDef samba_backend<a href="#classdef-samba_backend" class="hash-link" aria-label="Direct link to ClassDef samba_backend" title="Direct link to ClassDef samba_backend">​</a></h2>
<p><strong>samba_backend</strong>: The function of the samba_backend class is to serve as a specific implementation of the applier_backend base class, handling the retrieval and storage of Group Policy Objects (GPOs) settings in Samba environments.</p>
<p><strong>attributes</strong>:
· <code>__user_policy_mode_key</code>: A class-level attribute that stores the registry key for the UserPolicyMode parameter, used to determine if it is possible to work with the user&#x27;s part of the GPT.
· <code>cache_path</code>: An instance attribute that stores the path to the cache file for storing Kerberos credentials.
· <code>__kinit_successful</code>: An instance attribute that indicates whether the Kerberos initialization (kinit) was successful.
· <code>storage</code>: An instance attribute that represents the registry storage, used to interact with the Windows registry.
· <code>sid</code>: An instance attribute that stores the Security Identifier (SID) for the machine or user.
· <code>cache</code>: An instance attribute that represents the cache for registry policies.
· <code>gpo_names</code>: An instance attribute that stores the names of the GPOs.
· <code>sambacreds</code>: An instance attribute that stores the Samba credentials, including the domain, username, and password.
· <code>cache_dir</code>: An instance attribute that stores the directory path for the Samba cache.</p>
<p><strong>Code Description</strong>:
The samba_backend class is a derived class of applier_backend and is responsible for implementing the <code>retrieve_and_store</code> method to handle the retrieval and storage of GPO settings in Samba environments.</p>
<p>Upon instantiation, the samba_backend class initializes various attributes, including the cache path, Kerberos credentials, registry storage, Samba credentials, and cache directory. The <code>__del__</code> method is defined to destroy the Kerberos credentials when the object is deleted.</p>
<p>The <code>get_policy_mode</code> method retrieves the UserPolicyMode parameter value from the registry, which is used to determine if it is possible to work with the user&#x27;s part of the GPT.</p>
<p>The <code>retrieve_and_store</code> method is responsible for retrieving GPO settings and storing them in a database. It first retrieves the GPOs for the machine and then processes user GPOs if a user&#x27;s name is specified. The method checks the UserPolicyMode parameter and merges the user and machine GPO settings accordingly.</p>
<p>The <code>_check_sysvol_present</code> method checks if there is a SYSVOL path assigned to a GPO, and the <code>_get_gpts</code> method retrieves the GPOs for the specified username and SID.</p>
<p><strong>Relationship with derived classes</strong>:
The samba_backend class is a derived class of applier_backend and implements the <code>retrieve_and_store</code> method to handle GPO settings in Samba environments.</p>
<p><strong>Note</strong>:</p>
<ul>
<li>The samba_backend class is not meant to be instantiated directly. Instead, it should be used as a base class for creating specific Samba backend implementations.</li>
<li>The <code>retrieve_and_store</code> method should be implemented in derived classes to provide the actual logic for retrieving and storing GPO settings.</li>
</ul>
<p><strong>Output Example</strong>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Instantiating a samba_backend object</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sb </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> samba_backend</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sambacreds</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;username&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;domain&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Retrieving and storing GPO settings</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">retrieve_and_store</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Getting the UserPolicyMode parameter value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">upm </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_policy_mode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="functiondef-initself-sambacreds-username-domain-is_machine">FunctionDef <strong>init</strong>(self, sambacreds, username, domain, is_machine)<a href="#functiondef-initself-sambacreds-username-domain-is_machine" class="hash-link" aria-label="Direct link to functiondef-initself-sambacreds-username-domain-is_machine" title="Direct link to functiondef-initself-sambacreds-username-domain-is_machine">​</a></h3>
<p><strong><strong>init</strong></strong>: The function of <strong><strong>init</strong></strong> is to initialize the samba_backend object with the necessary parameters and perform some initial operations.</p>
<p><strong>parameters</strong>:
· <code>sambacreds</code>: An instance of the Smbacreds class, which contains the Samba connection information.
· <code>username</code>: A string representing the username to be used for authentication.
· <code>domain</code>: A string representing the domain to which the user belongs.
· <code>is_machine</code>: A boolean value indicating whether the user is a machine or not.</p>
<p><strong>Code Description</strong>:
The <strong><strong>init</strong></strong> function initializes the following attributes of the samba_backend object:</p>
<ol>
<li><code>cache_path</code>: A string representing the path to the Kerberos ticket cache file. It is generated using the current process ID and the format <code>/var/cache/gpupdate/creds/krb5cc_{}.</code></li>
<li><code>__kinit_successful</code>: A boolean value indicating whether the Kerberos ticket initialization was successful or not. It is set by calling the <code>machine_kinit</code> function with the <code>cache_path</code> as an argument. If the function returns <code>False</code>, an exception is raised.</li>
<li><code>storage</code>: An instance of the `sqlite_</li>
</ol>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="functiondef-delself">FunctionDef <strong>del</strong>(self)<a href="#functiondef-delself" class="hash-link" aria-label="Direct link to functiondef-delself" title="Direct link to functiondef-delself">​</a></h3>
<p><strong><code>__del__</code></strong>: The <code>__del__</code> function is a special method in Python, called when an object is about to be destroyed. In this specific case, it is used to ensure that any machine credentials are removed before the <code>samba_backend</code> object is deleted.</p>
<p><strong>parameters</strong>: This function does not take any parameters.</p>
<p><strong>Code Description</strong>:</p>
<ol>
<li>
<p>The <code>__del__</code> function checks if the <code>__kinit_successful</code> attribute is <code>True</code>. If it is, it means that machine credentials have been obtained and stored in a Kerberos ticket cache.</p>
</li>
<li>
<p>If <code>__kinit_successful</code> is <code>True</code>, the <code>machine_kdestroy()</code> function is called. This function securely removes the Kerberos ticket cache for the machine, which is used for authentication in a Kerberos environment.</p>
</li>
<li>
<p>By calling <code>machine_kdestroy()</code>, any machine credentials are removed before the <code>samba_backend</code> object is deleted, ensuring that sensitive information is not left behind.</p>
</li>
</ol>
<p><strong>Note</strong>:</p>
<ul>
<li>
<p>The <code>__del__</code> function should be used carefully, as it is called when an object is about to be destroyed. Make sure that any necessary cleanup or finalization tasks are performed within this function.</p>
</li>
<li>
<p>The <code>__del__</code> function relies on the <code>machine_kdestroy()</code> function to remove Kerberos ticket caches. Make sure that the <code>machine_kdestroy()</code> function is working as expected, as incorrect behavior could lead to unexpected consequences.</p>
</li>
<li>
<p>The <code>__del__</code> function is called automatically by Python, and its execution is not guaranteed. In some cases, the <code>__del__</code> function may not be called if the Python interpreter is terminated abruptly or if the object is part of a cyclic garbage collection. Therefore, it should not be used for critical tasks that must be performed before an object is destroyed.</p>
</li>
</ul>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="functiondef-get_policy_modeself">FunctionDef get_policy_mode(self)<a href="#functiondef-get_policy_modeself" class="hash-link" aria-label="Direct link to FunctionDef get_policy_mode(self)" title="Direct link to FunctionDef get_policy_mode(self)">​</a></h3>
<p><strong>get_policy_mode</strong>: The function of get_policy_mode is to retrieve the UserPolicyMode parameter value from the HKLM (HKEY_LOCAL_MACHINE) table in the SQLite database. This value is used to determine if it is possible to work with the user&#x27;s part of GPT (Group Policy Template).</p>
<p><strong>parameters</strong>:
· self: The instance of the samba_backend class.</p>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="functiondef-retrieve_and_storeself">FunctionDef retrieve_and_store(self)<a href="#functiondef-retrieve_and_storeself" class="hash-link" aria-label="Direct link to FunctionDef retrieve_and_store(self)" title="Direct link to FunctionDef retrieve_and_store(self)">​</a></h3>
<p><strong>retrieve_and_store</strong>: The function of retrieve_and_store is to retrieve and store machine and user settings from the Windows registry to a SQLite database.</p>
<p><strong>parameters</strong>: The parameters of this Function are as follows:
· self: The object that calls this function.
· machine_username: A boolean value indicating whether to store the machine username in the database.</p>
<p><strong>Code Description</strong>:</p>
<p>The retrieve_and_store function is defined in the gpoa/backend/nodomain_backend.py module and is responsible for retrieving machine and user settings from the Windows registry and storing them in a SQLite database. It is primarily called by the gpoa/backend/backend.py module&#x27;s start_backend_process function.</p>
<p>The function begins by wiping the HKLM and machine_sid user settings in the storage object. It then calls the get_machine_name function to get the localhost name and sets it as the machine_name attribute of the nodomain_backend object.</p>
<p>Next, the function retrieves the machine settings from the registry by calling the get_machine_settings function and stores them in the machine_settings attribute of the nodomain_backend object. It then calls the merge_machine function to merge the machine settings to the storage object.</p>
<p>After that, the function retrieves the user settings from the registry by calling the get_user_settings function and stores them in the user_settings attribute of the nodomain_backend object. It then calls the merge_user function to merge the user settings to the storage object.</p>
<p>Finally, the function sets the machine_username attribute of the nodomain_backend object to the machine_username parameter.</p>
<p><strong>Relationship with its callers in the project</strong>:</p>
<p>The retrieve_and_store function is primarily called by the start_backend_process function in the gpoa/backend/backend.py module. In this function, the retrieve_and_store function is called with the machine_username parameter set to True if the backend type is nodomain, and False otherwise.</p>
<p><strong>Note</strong>:</p>
<ul>
<li>The retrieve_and_store function assumes that the get_machine_name, get_machine_settings, get_user_settings, merge_machine, and merge_user functions have been called and have initialized the necessary variables.</li>
<li>The retrieve_and_store function is only intended to be called with a valid machine and user settings dictionary.</li>
<li>The retrieve_and_store function should be used carefully to ensure that the machine and user settings are retrieved and stored correctly to the storage object.</li>
<li>The retrieve_and_store function should be updated if new preference types are added to the project.</li>
<li>The retrieve_and_store function should be used consistently throughout the project to ensure that all machine and user settings are retrieved and stored correctly to the storage object.
Raw code:```
def retrieve_and_store(self, machine_username):
&#x27;&#x27;&#x27;
Retrieve and store machine and user settings from the Windows registry to a SQLite database.
&#x27;&#x27;&#x27;
self.wipe_hklm()
self.wipe_machine_sid()
self.machine_name = get_machine_name()
self.machine_settings = get_machine_settings()
self.merge_machine()
self.user_settings = get_user_settings()
self.merge_user()
self.machine_username = machine_username</li>
</ul>
<div class="language-========== codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-========== codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">obj: gpoa/backend/nodomain_backend.py/nodomain\_backend/get\_machine\_settings</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Document: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> **get\_machine\_settings**: The function of get\_machine\_settings is to retrieve machine settings from the Windows registry.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**parameters**: This function does not take any parameters.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Code Description**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The get\_machine\_settings function is defined in the gpoa/backend/nodomain\_backend.py module and is responsible for retrieving machine settings from the Windows registry. It is primarily called by the retrieve\_and\_store function in the nodomain\_backend module.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The function begins by initializing an empty dictionary called machine\_settings. It then iterates over the items in the HKLM hive of the Windows registry, excluding the &#x27;SOFTWARE&#x27; key. For each item, it gets the preference\_type using the get\_preftype function, passing in the preference\_path value as the path\_to\_file parameter. It then gets the parser function using the get\_parser function, passing in the preference\_type constant as the preference\_type parameter. The parser function is then called with the preference\_path value as the parameter, and the result is stored</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">***</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### FunctionDef _check_sysvol_present(self, gpo)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> **`_check_sysvol_present`**: The function of `_check_sysvol_present` is to check if there is a SYSVOL path for a given Group Policy Object (GPO).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**parameters**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">· `gpo`: An instance of the `gpoa.backend.samba_backend.GroupPolicyObject` class representing a GPO.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Code Description**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The function `_check_sysvol_present` first checks if the `gpo` object has a `file_sys_path` attribute. If this attribute is not present, the function checks if the name of the GPO is &quot;Local Policy&quot;. If the name is not &quot;Local Policy&quot;, a warning message is logged using the `log` function from the `gpoa.util.logging` module. The warning message includes the name of the GPO. The function then returns `False`, indicating that there is no SYSVOL path for the GPO.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">If the `file_sys_path` attribute is present, the function returns `True`, indicating that there is a SYSVOL path for the GPO.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The `log` function is used to log informational, warning, and error messages. It takes two arguments: a message code and an optional data dictionary. The message code is used to look up the message string in a message catalog, and the data dictionary is used to substitute variables into the message string.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The `_check_sysvol_present` function is called by the `_get_gpts` function in the `gpoa.backend.samba_backend` module. The `_get_gpts` function retrieves a list of GPOs for a given user and SID, and for each GPO, it checks if there is a SYSVOL path using the `_check_sysvol_present` function. If there is a SYSVOL path, the function creates a `gpt` object and adds it to a list of GPTs. If the GPO is the &quot;Local Policy&quot; GPO, the function creates a `LocalGPT` object and adds it to the list of GPTs.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Note**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The `_check_sysvol_present` function assumes that the `gpo` object has a `file_sys_path` attribute or a `name` attribute. If the `gpo` object does not have these attributes, the function may raise an `AttributeError` exception.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Output Example**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The `_check_sysvol_present` function returns `False` if there is no SYSVOL path for the GPO, and `True` if there is a SYSVOL path for the GPO. Here is an example output:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```python</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;&gt;&gt; gpo = GroupPolicyObject(name=&quot;Test GPO&quot;, file_sys_path=&quot;/path/to/sysvol/Test GPO&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;&gt;&gt; result = _check_sysvol_present(gpo)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;&gt;&gt; print(result)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">True</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this example, the <code>_check_sysvol_present</code> function returns <code>True</code> because the <code>gpo</code> object has a <code>file_sys_path</code> attribute.</p>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="functiondef-_get_gptsself-username-sid">FunctionDef _get_gpts(self, username, sid)<a href="#functiondef-_get_gptsself-username-sid" class="hash-link" aria-label="Direct link to FunctionDef _get_gpts(self, username, sid)" title="Direct link to FunctionDef _get_gpts(self, username, sid)">​</a></h3>
<p><strong>retrieve_and_store</strong>: The function of retrieve_and_store is to retrieve the settings from the Group Policy Objects (GPOs) and store them in a database.</p>
<p><strong>parameters</strong>: The parameters of this Function.
· self: The instance of the samba_backend class.</p>
<p><strong>Code Description</strong>: The description of this Function.
The retrieve_and_store function is called when the user wants to retrieve the settings from the GPOs and store them in a database. It first retrieves the GPOs for the machine by calling the _get_gpts function with the machine name and machine SID as parameters. If the user&#x27;s name is specified, it also retrieves the user GPOs by calling the _get_gpts function with the user name and user SID as parameters.</p>
<p>The function then wipes the HKEY_LOCAL_MACHINE (HKLM) and user keys from the storage object. For each GPO object in the machine_gpts list, it calls the merge_machine function to merge the machine settings to the storage object. If the user&#x27;s name is specified, it also calls the merge_user function for each GPO object in the user_gpts list to merge the user settings to the storage object.</p>
<p>The function also checks the policy mode and merges the user settings accordingly. If the policy mode is set to 1, it merges the user settings for HKEY_CURRENT_USER (HKCU) only. If the policy mode is set to 2, it merges the user settings for HKLM and HKCU.</p>
<p>The retrieve_and_store function is called in the gpoa/backend/samba_backend.py/samba_backend/apply_settings function to retrieve the settings from the GPOs and apply them to the system.</p>
<p><strong>Note</strong>: Points to note about the use of the code</p>
<ul>
<li>The retrieve_and_store function assumes that the _get_gpts function has been implemented and is working correctly.</li>
<li>The retrieve_and_store function modifies the storage object, so any changes made to it will be reflected in the system.</li>
<li>The retrieve_and_store function can raise exceptions if there are any errors while merging the settings to the storage object.</li>
</ul>
<p><strong>Output Example</strong>: Mock up a possible appearance of the code&#x27;s return value.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">retrieve_and_store</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;machine_name&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;machine_sid&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;user_name&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;user_sid&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">storage</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;hklm&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Output: The merged machine settings</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">storage</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;user&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Output: The merged user settings</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="functiondef-upm2strupm_num">FunctionDef upm2str(upm_num)<a href="#functiondef-upm2strupm_num" class="hash-link" aria-label="Direct link to FunctionDef upm2str(upm_num)" title="Direct link to FunctionDef upm2str(upm_num)">​</a></h2>
<p><strong>upm2str</strong>: The function of upm2str is to translate UserPolicyMode (UPM) to a string.</p>
<p><strong>parameters</strong>:
This function takes one parameter:</p>
<ul>
<li>upm_num: A number representing the UserPolicyMode. It can be an integer or a string.</li>
</ul>
<p><strong>Code Description</strong>:
The function initializes the result variable with the string &#x27;Not configured&#x27;. It then checks if the upm_num parameter is equal to 1 or &#x27;1&#x27;, and if so, sets the result variable to &#x27;Merge&#x27;. If upm_num is equal to 2 or &#x27;2&#x27;, the result variable is set to &#x27;Replace&#x27;. Finally, the function returns the result variable.</p>
<p>This function is used to provide a human-readable representation of the UserPolicyMode. It is called in the <code>retrieve_and_store</code> method of the <code>samba_backend</code> class, where it is used to log the policy mode in a more readable format.</p>
<p><strong>Note</strong>:</p>
<ul>
<li>The function accepts both integer and string values for the upm_num parameter, providing flexibility in its use.</li>
<li>It is important to note that the function only checks for exact matches of 1, 2, &#x27;1&#x27;, and &#x27;2&#x27;. Any other value passed as the upm_num parameter will result in the &#x27;Not configured&#x27; string being returned.</li>
</ul>
<p><strong>Output Example</strong>:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;Merge&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This is an example of what the function might return when called with an upm_num parameter of 1 or &#x27;1&#x27;.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/gpoa/backend/nodomain_backend"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">nodomain_backend</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/gpoa/frontend/applier_frontend"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">applier_frontend</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#classdef-samba_backend" class="table-of-contents__link toc-highlight">ClassDef samba_backend</a><ul><li><a href="#functiondef-initself-sambacreds-username-domain-is_machine" class="table-of-contents__link toc-highlight">FunctionDef <strong>init</strong>(self, sambacreds, username, domain, is_machine)</a></li><li><a href="#functiondef-delself" class="table-of-contents__link toc-highlight">FunctionDef <strong>del</strong>(self)</a></li><li><a href="#functiondef-get_policy_modeself" class="table-of-contents__link toc-highlight">FunctionDef get_policy_mode(self)</a></li><li><a href="#functiondef-retrieve_and_storeself" class="table-of-contents__link toc-highlight">FunctionDef retrieve_and_store(self)</a></li><li><a href="#functiondef-_get_gptsself-username-sid" class="table-of-contents__link toc-highlight">FunctionDef _get_gpts(self, username, sid)</a></li></ul></li><li><a href="#functiondef-upm2strupm_num" class="table-of-contents__link toc-highlight">FunctionDef upm2str(upm_num)</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/gpoa/backend/samba_backend">Samba Backend</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 BaseALT LTD, Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>