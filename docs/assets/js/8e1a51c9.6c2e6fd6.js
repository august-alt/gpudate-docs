"use strict";(self.webpackChunkgpupdate_docs=self.webpackChunkgpupdate_docs||[]).push([[5134],{9719:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>r,contentTitle:()=>o,default:()=>l,frontMatter:()=>c,metadata:()=>d,toc:()=>a});var t=i(4848),s=i(8453);const c={},o=void 0,d={id:"gpoa/backend/nodomain_backend",title:"nodomain_backend",description:"ClassDef nodomain_backend",source:"@site/docs/gpoa/backend/nodomain_backend.md",sourceDirName:"gpoa/backend",slug:"/gpoa/backend/nodomain_backend",permalink:"/docs/gpoa/backend/nodomain_backend",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"defaultSidebar",previous:{title:"freeipa_backend",permalink:"/docs/gpoa/backend/freeipa_backend"},next:{title:"samba_backend",permalink:"/docs/gpoa/backend/samba_backend"}},r={},a=[{value:"ClassDef nodomain_backend",id:"classdef-nodomain_backend",level:2},{value:"FunctionDef <strong>init</strong>(self)",id:"functiondef-initself",level:3},{value:"FunctionDef retrieve_and_store(self)",id:"functiondef-retrieve_and_storeself",level:3}];function h(e){const n={code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"classdef-nodomain_backend",children:"ClassDef nodomain_backend"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"nodomain_backend"}),": The function of the ",(0,t.jsx)(n.code,{children:"nodomain_backend"})," class is to serve as a specific implementation of the ",(0,t.jsx)(n.code,{children:"applier_backend"})," abstract base class, handling the retrieval and storage of Group Policy Objects (GPOs) settings in non-domain environments."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"attributes"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"domain"}),": Set to ",(0,t.jsx)(n.code,{children:"None"})," by default. This attribute is not used in the ",(0,t.jsx)(n.code,{children:"nodomain_backend"})," class."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"machine_name"}),": A string representing the machine name. It is initialized with the value returned by the ",(0,t.jsx)(n.code,{children:"get_machine_name()"})," function."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"machine_sid"}),": A string representing the machine's security identifier (SID). It is initialized with the value returned by the ",(0,t.jsx)(n.code,{children:"get_sid()"})," function, using the ",(0,t.jsx)(n.code,{children:"domain"})," and ",(0,t.jsx)(n.code,{children:"machine_name"})," attributes."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"storage"}),": An instance of the ",(0,t.jsx)(n.code,{children:"registry_factory('registry')"})," class. It is used to store and manage GPO settings."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"username"}),": A string representing the machine name. It is used to work with the HKCU hive."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"sid"}),": A string representing the machine's SID. It is used to work with the HKCU hive."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Code Description"}),":\nThe ",(0,t.jsx)(n.code,{children:"nodomain_backend"})," class is a concrete implementation of the ",(0,t.jsx)(n.code,{children:"applier_backend"})," abstract base class, specifically designed for non-domain environments. It initializes its attributes during instantiation, including the ",(0,t.jsx)(n.code,{children:"domain"}),", ",(0,t.jsx)(n.code,{children:"machine_name"}),", ",(0,t.jsx)(n.code,{children:"machine_sid"}),", ",(0,t.jsx)(n.code,{children:"storage"}),", ",(0,t.jsx)(n.code,{children:"username"}),", and ",(0,t.jsx)(n.code,{children:"sid"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"nodomain_backend"})," class overrides the ",(0,t.jsx)(n.code,{children:"retrieve_and_store"})," method from the ",(0,t.jsx)(n.code,{children:"applier_backend"})," class. This method is responsible for retrieving GPO settings and storing them in a database. In the ",(0,t.jsx)(n.code,{children:"nodomain_backend"})," class, the ",(0,t.jsx)(n.code,{children:"retrieve_and_store"})," method performs the following tasks:"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["It initializes the ",(0,t.jsx)(n.code,{children:"local_policy"})," object by calling the ",(0,t.jsx)(n.code,{children:"get_local_gpt()"})," function with the ",(0,t.jsx)(n.code,{children:"sid"})," attribute as its argument."]}),"\n",(0,t.jsxs)(n.li,{children:["It merges the machine and user policies by calling the ",(0,t.jsx)(n.code,{children:"merge_machine()"})," and ",(0,t.jsx)(n.code,{children:"merge_user()"})," methods of the ",(0,t.jsx)(n.code,{children:"local_policy"})," object."]}),"\n",(0,t.jsxs)(n.li,{children:["It wipes the HKLM and HKCU hives by calling the ",(0,t.jsx)(n.code,{children:"wipe_hklm()"})," and ",(0,t.jsx)(n.code,{children:"wipe_user()"})," methods of the ",(0,t.jsx)(n.code,{children:"storage"})," object, using the ",(0,t.jsx)(n.code,{children:"machine_sid"})," attribute as its argument."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Relationship with derived classes"}),":\nThe ",(0,t.jsx)(n.code,{children:"nodomain_backend"})," class is a direct implementation of the ",(0,t.jsx)(n.code,{children:"applier_backend"})," abstract base class, providing a specific way to handle GPO settings in non-domain environments."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Note"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"nodomain_backend"})," class is not meant to be instantiated directly. Instead, it is instantiated through the ",(0,t.jsx)(n.code,{children:"backend_factory()"})," function in the ",(0,t.jsx)(n.code,{children:"gpoa/backend/__init__.py"})," file."]}),"\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"retrieve_and_store"})," method should be implemented in derived classes to provide the actual logic for retrieving and storing GPO settings. In this case, the ",(0,t.jsx)(n.code,{children:"nodomain_backend"})," class provides a specific implementation for non-domain environments."]}),"\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"nodomain_backend"})," class is part of the ",(0,t.jsx)(n.code,{children:"gpoa"})," project, which handles the retrieval and storage of GPO settings in various environments, including non-domain, FreeIPA, and Samba environments."]}),"\n"]}),"\n",(0,t.jsxs)(n.h3,{id:"functiondef-initself",children:["FunctionDef ",(0,t.jsx)(n.strong,{children:"init"}),"(self)"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.strong,{children:"init"})}),": The function of ",(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.strong,{children:"init"})})," is to initialize the nodomain_backend object with necessary attributes."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"parameters"}),": The parameters of this Function.\n\xb7 None: The ",(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.strong,{children:"init"})})," function does not take any parameters."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Code Description"}),":\nThe ",(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.strong,{children:"init"})})," function initializes the nodomain_backend object with the following attributes:"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"domain"}),": This attribute is initialized to ",(0,t.jsx)(n.code,{children:"None"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"machine_name"}),": This attribute is set to the localhost name looking like ",(0,t.jsx)(n.code,{children:"DC0$"})," by calling the ",(0,t.jsx)(n.code,{children:"get_machine_name"})," function from the ",(0,t.jsx)(n.code,{children:"util"})," package."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"machine_sid"}),": This attribute is set to the SID (Security Identifier) for the local machine by calling the ",(0,t.jsx)(n.code,{children:"get_sid"})," function from the ",(0,t.jsx)(n.code,{children:"sid"})," module in the ",(0,t.jsx)(n.code,{children:"util"})," package. The ",(0,t.jsx)(n.code,{children:"get_sid"})," function takes three parameters: ",(0,t.jsx)(n.code,{children:"domain"}),", ",(0,t.jsx)(n.code,{children:"machine_name"}),", and ",(0,t.jsx)(n.code,{children:"is_machine"}),". In this case, the ",(0,t.jsx)(n.code,{children:"domain"})," parameter is set to ",(0,t.jsx)(n.code,{children:"None"}),", the ",(0,t.jsx)(n.code,{children:"machine_name"})," parameter is set to the value of the ",(0,t.jsx)(n.code,{children:"machine_name"})," attribute, and the ",(0,t.jsx)(n.code,{children:"is_machine"})," parameter is set to ",(0,t.jsx)(n.code,{children:"True"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"storage"}),": This attribute is set to an instance of the ",(0,t.jsx)(n.code,{children:"sqlite_registry"})," object by calling the ",(0,t.jsx)(n.code,{children:"registry_factory"})," function with the ",(0,t.jsx)(n.code,{children:"registry"})," parameter."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["After setting the above attributes, the ",(0,t.jsx)(n.code,{children:"set_info"})," method of the ",(0,t.jsx)(n.code,{children:"storage"})," object is called to set the following information:"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"domain"}),": This information is set to the value of the ",(0,t.jsx)(n.code,{children:"domain"})," attribute."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"machine_name"}),": This information is set to the value of the ",(0,t.jsx)(n.code,{children:"machine_name"})," attribute."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"machine_sid"}),": This information is set to the value of the ",(0,t.jsx)(n.code,{children:"machine_sid"})," attribute."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Finally, the ",(0,t.jsx)(n.code,{children:"username"})," and ",(0,t.jsx)(n.code,{children:"sid"})," attributes are set to the ",(0,t.jsx)(n.code,{children:"machine_name"})," and ",(0,t.jsx)(n.code,{children:"machine_sid"})," attributes, respectively."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Relationship with its callees in the project"}),":\nThe ",(0,t.jsx)(n.code,{children:"__init__"})," function calls the ",(0,t.jsx)(n.code,{children:"get_machine_name"})," function from the ",(0,t.jsx)(n.code,{children:"util"})," package to set the ",(0,t.jsx)(n.code,{children:"machine_name"})," attribute. It also calls the ",(0,t.jsx)(n.code,{children:"get_sid"})," function from the ",(0,t.jsx)(n.code,{children:"sid"})," module in the ",(0,t.jsx)(n.code,{children:"util"})," package to set the ",(0,t.jsx)(n.code,{children:"machine_sid"})," attribute."]}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"__init__"})," function creates an instance of the ",(0,t.jsx)(n.code,{children:"sqlite_registry"})," object by calling the ",(0,t.jsx)(n.code,{children:"registry_factory"})," function with the ",(0,t.jsx)(n.code,{children:"registry"})," parameter."]}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"set_info"})," method of the ",(0,t.jsx)(n.code,{children:"storage"})," object is called to set the ",(0,t.jsx)(n.code,{children:"domain"}),", ",(0,t.jsx)(n.code,{children:"machine_name"}),", and ",(0,t.jsx)(n.code,{children:"machine_sid"})," information in the ",(0,t.jsx)(n.code,{children:"sqlite_registry"})," object."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Note"}),":\nNone."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"functiondef-retrieve_and_storeself",children:"FunctionDef retrieve_and_store(self)"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"retrieve_and_store"}),": The function of retrieve_and_store is to retrieve settings and store them in a database."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"parameters"}),": This function does not take any parameters."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Code Description"}),":\nThe retrieve_and_store function is a method of the nodomain_backend class, which is defined in the gpoa/backend/nodomain_backend.py file. It performs the following steps:"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Wipe the HKLM and machine_sid user settings in the storage object by calling the wipe_hklm and wipe_user functions of the sqlite_registry object, respectively."}),"\n",(0,t.jsx)(n.li,{children:"Get the local GPT object for the machine SID by calling the get_local_gpt function and passing in the machine SID as an argument."}),"\n",(0,t.jsx)(n.li,{children:"Merge the machine and user settings of the local GPT object to the storage object by calling the merge_machine and merge_user functions of the local GPT object, respectively."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"The wipe_hklm function deletes all records in the HKLM table of the SQLite database, effectively wiping out all the entries in the HKLM hive of the Windows registry. The wipe_user function deletes all records associated with a given user from the SQLite database."}),"\n",(0,t.jsx)(n.p,{children:"The get_local_gpt function converts the default policy to GPT and creates an object out of it, with the name set to 'Local Policy'. It then returns the GPT object."}),"\n",(0,t.jsx)(n.p,{children:"The merge_machine function merges machine settings to storage, while the merge_user function merges user settings to storage."}),"\n",(0,t.jsx)(n.p,{children:"The retrieve_and_store function is called by the retrieve_and_store method of the backend object, which is defined in the gpoa/backend/backend.py file. The backend object calls the retrieve_and_store method of the appropriate backend object (nodomain_backend or samba_backend) based on the type of user (machine or user)."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Note"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"The retrieve_and_store function should only be called by the retrieve_and_store method of the backend object."}),"\n",(0,t.jsx)(n.li,{children:"The retrieve_and_store function should only be called after all records have been retrieved and stored in the database."}),"\n",(0,t.jsx)(n.li,{children:"The retrieve_and_store function should not be called if the user has not been authenticated."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Here's an example of how to use the retrieve_and_store function in the retrieve_and_store method of the backend object:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"backend = nodomain_backend()\nbackend.retrieve_and_store()\n"})}),"\n",(0,t.jsx)(n.p,{children:"In this example, the retrieve_and_store function is called on an instance of the nodomain_backend class. The function retrieves the settings and stores them in the database."}),"\n",(0,t.jsx)(n.hr,{})]})}function l(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>d});var t=i(6540);const s={},c=t.createContext(s);function o(e){const n=t.useContext(c);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(c.Provider,{value:n},e.children)}}}]);